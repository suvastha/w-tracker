<!-- /weighty/templates/profile_settings.html -->
{% extends "base.html" %}
{% block content %}
<h1 class="section-title">Profile</h1>
<form id="profileForm" class="grid grid-cols-1 sm:grid-cols-2 gap-3 max-w-xl">
  <label class="form-field">
    <span>Name</span>
    <input name="name" class="input" required>
  </label>
  <div class="form-field">
    <span>Height</span>
    <div class="flex gap-2">
      <input type="number" name="height_feet" class="input" min="1" max="8" placeholder="feet" required>
      <input type="number" name="height_inches" class="input" min="0" max="11" placeholder="inches" required>
    </div>
  </div>
  <label class="form-field">
    <span>Starting weight (kg)</span>
    <input type="number" step="0.1" min="20" max="400" name="starting_weight" class="input" required>
  </label>
  <label class="form-field">
    <span>Goal weight (kg)</span>
    <input type="number" step="0.1" min="20" max="400" name="goal_weight" class="input" required>
  </label>

  <div class="sm:col-span-2">
    <button class="btn-primary">Save</button>
  </div>
</form>

<script>
document.addEventListener('DOMContentLoaded', async () => {
  const form = document.getElementById('profileForm');
  // Load existing profile
  const r = await fetch('/api/profile'); const data = await r.json();
  const p = data.profile;
  for (const [k,v] of Object.entries(p)) {
    if (form[k]) form[k].value = v;
  }
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const body = {
      name: form.name.value.trim(),
      height_feet: +form.height_feet.value,
      height_inches: +form.height_inches.value,
      starting_weight: +form.starting_weight.value,
      goal_weight: +form.goal_weight.value,
    };
    const res = await fetch('/api/profile', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(body)
    });
    const j = await res.json();
    if (j.ok) showToast('Profile saved âœ…');
    else showToast('Error saving profile', 'error');
  });
});
</script>
{% endblock %}
